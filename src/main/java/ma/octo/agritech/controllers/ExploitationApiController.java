package ma.octo.agritech.controllers;

import ma.octo.agritech.domains.Exploitation;
import ma.octo.agritech.domains.Village;
import ma.octo.agritech.requests.StoreExploitationRequest;
import ma.octo.agritech.services.ExploitationService;
import ma.octo.agritech.services.VillageService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.MediaType;
import org.springframework.security.access.prepost.PreAuthorize;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@RestController
@RequestMapping(value = "api/exploitations")
public class ExploitationApiController {

    @Autowired
    private ExploitationService exploitationService;
    @Autowired
    VillageService villageService;


    @GetMapping(produces = {MediaType.APPLICATION_JSON_UTF8_VALUE})
    public List<Exploitation> getAll() {
        return this.exploitationService.getAll();
    }

    @PreAuthorize("hasRole('ROLE_AGRICULTEUR')")
    @PostMapping(consumes = {MediaType.APPLICATION_JSON_UTF8_VALUE}, produces = {MediaType.APPLICATION_JSON_UTF8_VALUE})
    public Exploitation store(@RequestBody StoreExploitationRequest storeExploitationRequest) {

        return this.exploitationService.saveByStoreRequest(storeExploitationRequest);
    }

//
//    @GetMapping(produces = {MediaType.APPLICATION_JSON_UTF8_VALUE})
//    public  List<Exploitation> showByVillage(@PathVariable("villageName") String villageName){
//        Village village = this.villageService.getByName(villageName);
//        long villageId = village.getId();
//        return this.exploitationService.getAllByVillage(villageId);
//    }

}
